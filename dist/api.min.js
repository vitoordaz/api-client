define("api",["jquery","underscore","utils"],function(a,b,c){"use strict";function d(a,b){this.config=a,this.credentials=b,this.name="API"}return d.prototype.request=function(d,e,f,g){"function"==typeof f&&(g=f,f=void 0),g=g||c.noop;var h=this.config.server;"/"!==b.last(h)&&(h+="/"),h+=e;var i={type:d,complete:function(a,b){var c=a.status,d=a.responseJSON||{};"success"===b&&c>=200&&300>c?g(null,d):g(d,null)}.bind(this)};return b.isEmpty(f)||("GET"===d?i.data=f:("POST"===d||"PUT"===d)&&(i.contentType="application/json",i.data=JSON.stringify(f))),i.timeout=5e3,this.authorizeRequest(e,i),a.ajax(h,i)},d.prototype.authorizeRequest=function(a,b){if("auth/"!==a){var c=this.credentials;c&&(b.headers=b.headers||{},b.headers.Authorization="user "+window.btoa(c.key+":"+c.secret))}},d.prototype.auth=function(a){return this.request("POST","auth/",a).then(b.bind(function(a){return this.credentials=a,a},this))},d.prototype.createInteraction=function(a){return this.request("POST","interaction/",a).then(function(a){return a})},d.prototype.getScript=function(a,b){this.request("GET","script/"+a,b||c.noop)},d.prototype.listCustomers=function(a,b){b=b||c.noop,this.request("GET","customer",a,function(a,c){a?b(a):b(null,c)}.bind(this))},d.prototype.getUserSelf=function(){return this.request("GET","user/self")},d.prototype.getUserSalesScript=function(){return this.request("GET","user/self/script")},d});