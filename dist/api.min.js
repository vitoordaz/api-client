define("api",["jquery","underscore","utils"],function(a,b,c){"use strict";function d(b){this.config=a.extend({server:"https://api2.absdata.ru"},b||{}),this.name="API"}return d.prototype.request=function(c,d,e){var f=this.config.server;"/"!==b.last(f)&&(f+="/"),"/"===b.first(d)&&(d=d.substr(1)),f+=d;var g={type:c};return b.isEmpty(e)||("GET"===c?g.data=e:("POST"===c||"PUT"===c)&&(g.contentType="application/json",g.data=JSON.stringify(e))),g.timeout=5e3,this.authorizeRequest(d,g).then(function(b){return a.ajax(f,b)})},d.prototype.authorizeRequest=function(b,d){return"auth/"===b?a.Deferred().resolve(d):c.credentials.get().then(function(a){return d.headers=d.headers||{},d.headers.Authorization="user "+window.btoa(a.key+":"+a.secret),d})},d.prototype.auth=function(a){return this.request("POST","auth/",a)},d.prototype.createInteraction=function(a){return this.request("POST","interaction/",a)},d.prototype.getScript=function(a){return this.request("GET","script/"+a)},d.prototype.listCustomers=function(a){return this.request("GET","customer",a)},d.prototype.getUserSelf=function(){return this.request("GET","user/self")},d.prototype.getUserSalesScript=function(){return this.request("GET","user/self/script")},d});