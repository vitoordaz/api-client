define("api",["jquery","underscore","utils"],function(a,b,c){"use strict";function d(a,b){this.config=a,this.credentials=b,this.name="API"}return d.prototype.request=function(d,e,f,g){"function"==typeof f&&(g=f,f=void 0),g=g||c.noop;var h=this.config.server+e,i={type:d,complete:function(a,b){var c=a.status,e=a.responseJSON||{};console.groupCollapsed("%s: %s %s %s (HTTP %s)",this.name,d,h,b,c),console.dir(e),console.groupEnd(),"success"===b&&c>=200&&300>c?g(null,e):g(e,null)}.bind(this)};return b.isEmpty(f)||("GET"===d?i.data=f:("POST"===d||"PUT"===d)&&(i.contentType="application/json",i.data=JSON.stringify(f))),i.timeout=5e3,this.authorizeRequest(e,i),a.ajax(h,i)},d.prototype.authorizeRequest=function(a,b){if("auth/"!==a){var c=this.credentials;c&&(b.headers=b.headers||{},b.headers.Authorization="user "+window.btoa(c.key+":"+c.secret))}},d.prototype.auth=function(a,b){b=b||c.noop,this.request("POST","auth/",a,function(a,c){a||(this.credentials=c),b(a,c)}.bind(this))},d.prototype.getScript=function(a,b){this.request("GET","script/"+a,b||c.noop)},d.prototype.listCustomers=function(a,b){b=b||c.noop,this.request("GET","customer",a,function(a,c){a?(console.error("Cannot load customer",a),b(a)):b(null,c)}.bind(this))},d.prototype.getUserSelf=function(a){this.request("GET","user/self",a||c.noop)},d.prototype.getUserSalesScript=function(a){this.request("GET","user/self/script",a||c.noop)},d});