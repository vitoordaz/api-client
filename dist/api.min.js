define("api",["jquery","underscore","utils"],function(a,b,c){"use strict";function d(b){this.config=a.extend({server:"https://api2.absdata.ru"},b||{}),this.name="API"}return d.prototype.request=function(d,e,f,g){"function"==typeof f&&(g=f,f=void 0),g=g||c.noop;var h=this.config.server;"/"!==b.last(h)&&(h+="/"),h+=e;var i={type:d,complete:function(a,b){var c=a.status,d=a.responseJSON||{};"success"===b&&c>=200&&300>c?g(null,d):g(d,null)}.bind(this)};return b.isEmpty(f)||("GET"===d?i.data=f:("POST"===d||"PUT"===d)&&(i.contentType="application/json",i.data=JSON.stringify(f))),i.timeout=5e3,this.authorizeRequest(e,i).then(function(b){return a.ajax(h,b)})},d.prototype.authorizeRequest=function(b,d){return"auth/"===b?a.Deferred().resolve(d):c.credentials.get().then(function(a){return d.headers=d.headers||{},d.headers.Authorization="user "+window.btoa(a.key+":"+a.secret),d})},d.prototype.auth=function(a){return this.request("POST","auth/",a)},d.prototype.createInteraction=function(a){return this.request("POST","interaction/",a)},d.prototype.getScript=function(a,b){this.request("GET","script/"+a,b||c.noop)},d.prototype.listCustomers=function(a,b){b=b||c.noop,this.request("GET","customer",a,function(a,c){a?b(a):b(null,c)}.bind(this))},d.prototype.getUserSelf=function(){return this.request("GET","user/self")},d.prototype.getUserSalesScript=function(){return this.request("GET","user/self/script")},d});